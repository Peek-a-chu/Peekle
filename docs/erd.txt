erDiagram

    USERS ||--o{ LEAGUE_HISTORY : records
    USERS ||--o{ STUDY_MEMBERS : joins
    USERS ||--o{ SUBMISSION_LOGS : submits
    USERS ||--o{ WORKBOOKS : creates
    USERS ||--o{ WORKBOOK_BOOKMARKS : bookmarks
    USERS ||--o{ WORKBOOKS : creates
    USERS ||--o{ WORKBOOK_BOOKMARKS : bookmarks
    USERS ||--o{ DAILY_SOLVED_COUNTS : records
    USERS ||--o{ POINT_LOGS : earns

    LEAGUE_GROUPS ||--o{ USERS : contains

    STUDY_ROOMS ||--o{ STUDY_MEMBERS : has
    STUDY_ROOMS ||--o{ STUDY_CHAT_LOGS : contains
    STUDY_ROOMS ||--o{ STUDY_PROBLEMS : assigned
    STUDY_CHAT_LOGS ||--o{ SUBMISSION_LOGS : references_code

    PROBLEMS ||--o{ SUBMISSION_LOGS : referenced_in
    PROBLEMS ||--o{ WORKBOOK_PROBLEMS : included_in
    PROBLEMS ||--o{ PROBLEM_TAGS : has

    TAGS ||--o{ PROBLEM_TAGS : classified_as

    WORKBOOKS ||--o{ WORKBOOK_PROBLEMS : contains
    WORKBOOKS ||--o{ WORKBOOK_BOOKMARKS : saved_by

    USERS {
        BIGINT id PK
        VARCHAR(255) social_id UK
        VARCHAR(20) provider NN %% KAKAO | NAVER | GOOGLE
        VARCHAR(50) nickname UK 
        VARCHAR(255) profile_img        
        VARCHAR(20) tier %% CURRENT_TIER (Enum) (Initial: BRONZE_5)
        INT league_point %% 이번 주 획득 점수 (Default: 0)
        BIGINT league_group_id FK %% 이번 주 배정된 리그 그룹 (Nullable)
        INT streak_current %% (Default: 0)
        INT streak_max %% (Default: 0)
        VARCHAR(20) max_league %% 최고 도달 리그 (Initial: BRONZE_5), Update on League History update
        BOOLEAN is_deleted %% (Default: FALSE)
        DATETIME created_at NN
        %% VARCHAR(50) boj_id %% 백준 ID (확장프로그램 연동용) 일단 보류
    }

    LEAGUE_GROUPS {
        BIGINT id PK
        VARCHAR(20) tier %% 티어 등급
        INT season_week %% YYYYWW (ex: 202410)
        DATETIME created_at
    }
    
    %% 스트릭 용 테이블
    DAILY_SOLVED_COUNTS { 
        BIGINT id PK
        BIGINT user_id FK
        DATE solved_date
        INT problem_count %% 성공한 문제 수(같은 문제일 경우엔 안올라야함)
    }

    POINT_LOGS {
        BIGINT id PK
        BIGINT user_id FK
        VARCHAR(20) category %% PROBLEM | GAME
        INT amount %% 획득 점수 (+10, +3)
        VARCHAR(255) description %% UI 표시용 ("백준 1000번 문제 해결", "스피드전 1등")
        TEXT metadata %% JSON: { "type": "GAME", "mode": "SPEED_TEAM", "result": "WIN", "roomId": 101 } OR { "type": "PROBLEM", "problemId": 1000 }
        DATETIME created_at
    }

    LEAGUE_HISTORY {
        BIGINT id PK
        BIGINT user_id FK
        VARCHAR(20) tier %% 당시 티어
        INT final_point
        INT final_rank
        VARCHAR(20) result %% PROMOTED | STAY | DEMOTED
        INT season_week %% YYYYWW (ex: 202410)
        DATETIME closed_at %% 시즌 종료일
    }

    STUDY_ROOMS {
        BIGINT id PK
        VARCHAR(100) title
        TEXT description
        BIGINT owner_id FK
        BOOLEAN is_active
        INT ranking_point %% 스터디 그룹 랭킹용 총점 (Cache)
        DATETIME created_at
    }

    STUDY_MEMBERS {
        BIGINT id PK
        BIGINT study_id FK
        BIGINT user_id FK
        VARCHAR(20) role %% OWNER | MEMBER
        DATETIME joined_at
    }

    STUDY_CHAT_LOGS {
        BIGINT id PK
        BIGINT study_id FK
        BIGINT user_id FK
        TEXT message
        VARCHAR(20) type %% TALK | CODE_REVIEW | SYSTEM
        BIGINT ref_submission_id FK %% 코드 멘션 시 연결 (Nullable)
        TEXT metadata %% JSON: { "line_number": 12, "selected_text": "import sys" }
        DATETIME created_at
    }

    STUDY_PROBLEMS {
        BIGINT id PK
        BIGINT study_id FK
        BIGINT problem_id FK
        DATE problem_date %% 해당 문제가 배정된 날짜 (캘린더용)
        BIGINT created_by FK %% 문제를 추가한 사람
        DATETIME created_at
    }

    PROBLEMS {
        BIGINT id PK
        VARCHAR(20) source NN %% BOJ | SWEA
        VARCHAR(50) external_id UK %% 1000 (문제번호)
        VARCHAR(255) title NN
        VARCHAR(20) tier NN %% Gold 5
        TEXT url NN
    }

    SUBMISSION_LOGS {
        BIGINT id PK
        BIGINT user_id FK
        BIGINT problem_id FK
        VARCHAR(20) source_type %% STUDY | GAME | EXTENSION
        BIGINT room_id FK %% 스터디/게임 방 ID (Nullable)
        VARCHAR(255) problem_title %% 문제 제목 (Denormalized)
        VARCHAR(20) problem_tier %% 문제 티어 (Denormalized)
        TEXT code %% 제출 코드 (Text)
        VARCHAR(20) result %% "SUCCESS | FAIL"
        INT memory
        INT execution_time
        VARCHAR(50) language
        DATETIME submitted_at
    }



    WORKBOOKS {
        BIGINT id PK
        BIGINT owner_id FK
        VARCHAR(100) title
        TEXT description
        BOOLEAN is_public
        INT bookmark_count
    }

    WORKBOOK_PROBLEMS {
        BIGINT workbook_id FK
        BIGINT problem_id FK
        INT display_order NN %% 문제 순서
        DATETIME created_at NN
    }

    WORKBOOK_BOOKMARKS {
        BIGINT workbook_id FK
        BIGINT user_id FK
        DATETIME created_at NN
    }

    TAGS {
        BIGINT id PK
        VARCHAR(50) key UK %% implementation
        INT boj_tag_id UK %% 102
        VARCHAR(50) name_ko NN %% 구현
        VARCHAR(50) name_en %% implementation
    }

    PROBLEM_TAGS {
        BIGINT problem_id FK
        BIGINT tag_id FK
    }