# S4-8. 코드 보기 모드 (Real-time & Saved)

## 📌 Story Information
- **Epic**: Epic-04 (Study)
- **Story ID**: S4-8
- **Sprint**: TBD
- **Estimated Effort**: 2 days
- **Priority**: High
- **Dependencies**: Epic-03, S4-6
- **Status**: Ready

---

## 🧾 User Story

**As a** 사용자
**I want to** 다른 사람의 코드를(실시간 또는 제출된) 편하게 검토하고 싶다
**So that** 코드를 참고하거나 리뷰해주기 위함이다

---

## ✅ Acceptance Criteria

1. **실시간 보기**
   - 특정 유저 선택 시, 내 IDE 오른쪽에 대상 유저의 코드가 실시간으로 표시된다 (Split View).

2. **저장된 코드 보기**
   - 문제 목록에서 선택 시, 해당 유저의 최종 제출 코드가 읽기 전용으로 표시된다.

3. **복귀**
   - "내 코드만 보기" 버튼으로 언제든지 복귀할 수 있어야 한다.

---

## 🎨 UI Specification

### 참조 와이어프레임
- [코드 열람 모드 (Split View)](../../../pics/study_room_read_other.svg)
- [IDE 기본 화면 (내 코드만 보기)](../../../pics/look_own_code_ide.svg)

### View Mode 종류

| Mode | 트리거 | 화면 구성 |
|------|--------|----------|
| `ONLY_MINE` | 기본 상태, 내 비디오 타일 클릭, "내 코드만 보기" 클릭 | 내 코드 에디터만 전체 화면 |
| `SPLIT_REALTIME` | 다른 참여자 비디오 타일 클릭 | Split View - 좌: 내 코드, 우: 대상의 실시간 코드 |
| `SPLIT_SAVED` | 코드 보관함에서 "코드 확인하기" 클릭 | Split View - 좌: 내 코드, 우: 저장된 코드 (읽기 전용) |

### 실시간 코드 보기 진입 흐름 (SPLIT_REALTIME)

**STEP 1: 비디오 타일 클릭**
```
┌─────────────────────────────────────────────────────────────────┐
│ Video Grid                                                      │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                │
│ │  나(L)   │ │CodeNinja│ │ PS러버  │ │ 백준킹  │                │
│ │         │ │  ← 클릭  │ │   🔇    │ │   🔇    │                │
│ └─────────┘ └─────────┘ └─────────┘ └─────────┘                │
│               ↓                                                 │
│         STEP1: 클릭                                             │
└─────────────────────────────────────────────────────────────────┘
```

**STEP 2: Split View 활성화**
```
┌──────────────────────────────────────────────────────────────────┐
│ [Python ▼]  ◎ CodeNinja의 코드 열람 중  [내 코드만 보기] [🌙][📋] │
├────────────────────────────┬─────────────────────────────────────┤
│         내 코드             │        CodeNinja의 코드 (실시간)    │
│                            │                                     │
│  1 │ import heapq          │  1 │ import heapq                   │
│  2 │ import sys            │  2 │ import sys                     │
│  3 │ ...                   │  3 │ input = sys.stdin.readline     │
│                            │  4 │ INF = int(1e9)                 │
│    [편집 가능]              │  5 │ ...                            │
│                            │                                     │
│                            │     [읽기 전용 - 실시간 동기화]      │
├────────────────────────────┴─────────────────────────────────────┤
│ 🟠 타인의 코드를 열람 중입니다. 내 타일을 클릭하면 내 코드로 돌아갑니다. │
└──────────────────────────────────────────────────────────────────┘
```

### 비디오 타일 상태 표시

| 상태 | 시각적 표현 |
|------|------------|
| **코드 열람 중인 대상** | 노란색 테두리 (2px solid yellow) |
| **Active Speaker** | 녹색 테두리 또는 마이크 아이콘 강조 |
| **음소거** | 타일 우하단에 🔇 아이콘 |
| **내 타일** | "(나)" 또는 "(L)" 라벨 표시 |

### 열람 모드 UI 요소

**1. 상단 Toolbar**
```
┌──────────────────────────────────────────────────────────────────┐
│ [Python ▼]  ◎ CodeNinja의 코드 열람 중  [내 코드만 보기] [🌙][📋][💬] │
└──────────────────────────────────────────────────────────────────┘
```
- `◎ {닉네임}의 코드 열람 중`: 현재 열람 대상 표시 (분홍색 배지)
- `[내 코드만 보기]`: 클릭 시 ONLY_MINE 모드로 복귀

**2. 하단 알림 배너**
```
┌──────────────────────────────────────────────────────────────────┐
│ 🟠 타인의 코드를 열람 중입니다. 내 타일을 클릭하면 내 코드로 돌아갑니다. │
└──────────────────────────────────────────────────────────────────┘
```
- 분홍/주황색 배경
- 열람 모드일 때만 표시

### 저장된 코드 보기 (SPLIT_SAVED)

코드 보관함에서 "코드 확인하기" 클릭 시:
```
┌──────────────────────────────────────────────────────────────────┐
│ [Python ▼]  📦 CodeNinja의 저장된 코드  [내 코드만 보기] [🌙][📋] │
├────────────────────────────┬─────────────────────────────────────┤
│         내 코드             │    CodeNinja의 코드 (1753. 최단경로) │
│                            │    PYTHON 3 | 34.2MB | 142ms        │
│  1 │ import heapq          │                                     │
│  2 │ import sys            │  1 │ import heapq                   │
│  3 │ ...                   │  2 │ import sys                     │
│                            │  3 │ input = sys.stdin.readline     │
│    [편집 가능]              │  ...                                │
│                            │                                     │
│                            │     [읽기 전용 - 저장된 코드]        │
└────────────────────────────┴─────────────────────────────────────┘
```

### 상태 관리 (useViewModeStore)

```typescript
interface ViewModeState {
  mode: 'ONLY_MINE' | 'SPLIT_REALTIME' | 'SPLIT_SAVED';
  targetUser: {
    id: number;
    nickname: string;
  } | null;
  targetSubmission: {
    id: number;
    problemTitle: string;
    language: string;
    memory: number;
    executionTime: number;
    code: string;
  } | null;
}
```

---

## 🛠 Implementation Tasks

- [ ] Split Editor 레이아웃 구현 (좌: 내 코드, 우: 타인 코드)
- [ ] View Mode 상태 관리 스토어 구현 (`useViewModeStore`)
- [ ] 비디오 타일 클릭 핸들러 (SPLIT_REALTIME 모드 전환)
- [ ] 코드 보관함 연동 (SPLIT_SAVED 모드 전환)
- [ ] 실시간 코드 동기화 로직 (WebSocket/CRDT)
- [ ] 열람 대상 비디오 타일 노란색 테두리 스타일
- [ ] 상단 열람 모드 표시 UI (배지 + "내 코드만 보기" 버튼)
- [ ] 하단 알림 배너 컴포넌트
