# S4-9. 채팅 및 코드 공유 (Right Panel)

## 📌 Story Information
- **Epic**: Epic-04 (Study)
- **Story ID**: S4-9
- **Sprint**: TBD
- **Estimated Effort**: 1 day
- **Priority**: Medium
- **Dependencies**: Epic-03
- **Status**: Ready

---

## 🧾 User Story

**As a** 사용자
**I want to** 코드에 대해 채팅으로 소통하고 특정 풀이를 공유하고 싶다
**So that** "이 부분 봐주세요"라고 말할 때 정확한 맥락을 전달하기 위함이다

---

## ✅ Acceptance Criteria

1. **채팅창**
   - 마크다운 렌더링을 지원해야 한다.

2. **코드 공유**
   - 공유하기 모드에서 메시지 전송 시, 클릭 가능한 "코드 공유 카드"가 전송되어야 한다.
   - 카드를 클릭한 다른 유저들은 즉시 공유자의 해당 코드 뷰로 이동해야 한다.

---

## 🎨 UI Specification

### 참조 와이어프레임
- [채팅 및 코드 리뷰](../../../pics/code_review_by_chat.svg)

### Right Panel 탭 구조
```
┌─────────────────────────────┐
│      [채팅]  [참여자 (3/4)]   │  ← 탭 전환
├─────────────────────────────┤
│                             │
│      채팅 또는 참여자 목록     │
│                             │
└─────────────────────────────┘
```

### 채팅 탭 레이아웃
```
┌─────────────────────────────┐
│      [채팅]  [참여자 (3/4)]   │
├─────────────────────────────┤
│ ┌─────────────────────────┐ │
│ │ 🟡 CodeNinja            │ │  ← 상대방 메시지 (좌측 정렬)
│ │ 오늘 문제 어렵네요 ㅠㅠ   │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │             알고마스터 🟡│ │  ← 내 메시지 (우측 정렬, 분홍 배경)
│ │ 다익스트라 잘 정리해두면 │ │
│ │ 좋아요!                 │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ 🟡 PS러버               │ │
│ │ ┌───────────────────┐   │ │  ← 코드 공유 카드
│ │ │ import heapq      │   │ │
│ │ └───────────────────┘   │ │
│ │ 이렇게 시작하면 돼요     │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ 🟡 백준킹               │ │
│ │ 감사합니다!              │ │
│ └─────────────────────────┘ │
├─────────────────────────────┤
│ [메시지 입력...]        [📤] │  ← 입력창
└─────────────────────────────┘
```

### 채팅 메시지 타입

| type | 설명 | UI 예시 |
|------|------|---------|
| `TALK` | 일반 텍스트 메시지 | "오늘 문제 어렵네요 ㅠㅠ" |
| `CODE_SHARE` | 코드 스니펫 공유 | 코드 블록 카드 + 설명 텍스트 |
| `SYSTEM` | 시스템 알림 | "[CodeNinja님이 입장했습니다]" |

### 일반 메시지 (TALK)
```
┌─────────────────────────────┐
│ 🟡 CodeNinja                │  ← 프로필 이미지 + 닉네임
│ 오늘 문제 어렵네요 ㅠㅠ       │  ← 메시지 내용 (마크다운 지원)
└─────────────────────────────┘
```

### 내 메시지 (우측 정렬)
```
┌─────────────────────────────┐
│               알고마스터 🟡  │  ← 닉네임 + 프로필 이미지
│ 다익스트라 잘 정리해두면     │  ← 분홍색 말풍선 배경
│ 좋아요!                     │
└─────────────────────────────┘
```

### 코드 공유 카드 (CODE_SHARE)
```
┌─────────────────────────────┐
│ 🟡 PS러버                   │
│ ┌───────────────────────┐   │
│ │ import heapq          │   │  ← 코드 스니펫 (클릭 가능)
│ │ ...                   │   │     클릭 시 해당 코드 뷰로 이동
│ └───────────────────────┘   │
│ 이렇게 시작하면 돼요         │  ← 설명 텍스트
└─────────────────────────────┘
```

### 코드 공유 카드 상세
| 요소 | 설명 |
|------|------|
| **코드 블록** | 회색/어두운 배경, 고정폭 폰트, 최대 5줄 미리보기 |
| **클릭 동작** | 클릭 시 공유자의 해당 코드로 Split View 전환 (S4-8 연동) |
| **설명 텍스트** | 코드 블록 하단에 일반 텍스트로 표시 |

### 시스템 메시지 (SYSTEM)
```
┌─────────────────────────────┐
│    ─── CodeNinja님이 ───    │  ← 중앙 정렬, 회색 텍스트
│    ─── 입장했습니다 ───     │
└─────────────────────────────┘
```

### 입력창
```
┌──────────────────────────────────┐
│ [메시지를 입력하세요...]      [📤] │
└──────────────────────────────────┘
```
- Enter 키로 전송
- Shift + Enter로 줄바꿈
- 📤 버튼 클릭으로 전송

### 마크다운 지원 범위
- **굵게**: `**텍스트**`
- *기울임*: `*텍스트*`
- `인라인 코드`: `` `코드` ``
- 코드 블록: ` ``` `
- 링크: `[텍스트](URL)`

---

## 🛠 Implementation Tasks

- [ ] Right Panel 탭 구조 구현 (채팅 / 참여자)
- [ ] 채팅 메시지 목록 컴포넌트 구현 (스크롤, 자동 스크롤)
- [ ] 메시지 버블 컴포넌트 구현 (내 메시지 / 상대 메시지 구분)
- [ ] Markdown Parser 적용 (`react-markdown`)
- [ ] Chat Message 타입 정의 (`TALK`, `CODE_SHARE`, `SYSTEM`)
- [ ] 코드 공유 카드 컴포넌트 구현
- [ ] 코드 공유 카드 클릭 핸들러 (S4-8 View Mode 전환)
- [ ] WebSocket 채팅 연동 (실시간 메시지 송수신)
- [ ] 입력창 컴포넌트 구현 (Enter 전송, Shift+Enter 줄바꿈)
