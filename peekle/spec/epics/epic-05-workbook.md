# Epic-05: 문제집 및 검색 (Workbooks & Search)

## 📌 Overview
이 문서는 **문제집 및 검색**에 대한 전체 에픽 및 스토리 세부 내역을 제공합니다. 사용자가 자신만의 문제 목록을 관리하고, AI 임베딩 기반의 시맨틱 검색과 추천을 통해 학습 효율을 높이는 기능을 다룹니다.

## 📋 Stories

### 05.1. 통합 검색 바 (Frontend)
**User Story**
> **사용자**로서, **이름으로 문제, 문제집 또는 사용자를 검색**하고 싶다.
> 원하는 콘텐츠나 사람을 빠르고 정확하게 찾기 위함이다.

**✅ Acceptance Criteria**
- [ ] 검색 바 입력 시 디바운스된 자동 완성 제안 목록이 드롭다운으로 나타나야 한다.
- [ ] 검색 결과 페이지에서 "문제", "사용자", "문제집" 탭으로 결과가 분류되어 표시되어야 한다.
- [ ] 키보드 네비게이션(화살표 키)으로 결과를 선택할 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] `GlobalSearchBar` 컴포넌트 UI 구현
- [ ] `useSearch` 커스텀 훅 (API 호출 및 상태 관리)
- [ ] 검색 결과 하이라이팅 처리

### 05.2. 검색 API 래퍼 (Backend)
**User Story**
> **클라이언트**로서, **단일 엔드포인트로 문제와 사용자를 검색**하고 싶다.
> 프론트엔드 로직을 단순화하고 백엔드에서 검색 전략(DB LIKE vs Vector)을 유연하게 전환하기 위함이다.

**✅ Acceptance Criteria**
- [ ] `GET /api/v1/search?q={query}` 호출 시 DTO에 문제, 사용자, 문제집 결과를 담아 반환해야 한다.
- [ ] 검색어 타입이나 옵션에 따라 MySQL `LIKE` 검색 또는 Vector DB 검색을 적절히 수행해야 한다.

**🛠 Implementation Tasks**
- [ ] `SearchController` 및 `IntegratedSearchService` 구현
- [ ] 검색 전략 패턴(Strategy Pattern) 구조 설계

### 05.3. 문제집 목록 & 생성 (Left Panel) (Frontend)
**User Story**
> **사용자**로서, **다양한 문제집을 탐색하고 새로운 문제집을 생성**하고 싶다.
> 내 학습 목적에 맞는 문제집을 찾거나, 스터디를 위한 나만의 커리큘럼을 만들기 위함이다.

**✅ Acceptance Criteria**
**[문제집 목록]**
- [ ] **[탭 분류]** "전체", "내 문제집", "북마크한 문제집" 3개의 탭으로 구분되어야 한다.
- [ ] **[정렬]** "최신순", "북마크순" 정렬 옵션을 제공해야 한다.
- [ ] **[생성 버튼]** 상단에 "문제집 생성" 버튼이 노출되어야 한다.

**[문제집 생성]**
- [ ] 생성 버튼 클릭 시 모달이 아닌 인라인 폼 또는 모달이 뜨고, **제목**과 **설명**을 입력하여 생성할 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] `WorkbookList` 컴포넌트 및 정렬 로직 구현
- [ ] `WorkbookCreateForm` 구현

### 05.4. 문제집 상세 & 편집 (Right Panel) (Frontend)
**User Story**
> **사용자**로서, **선택한 문제집의 문제를 확인하고, 필요 시 수정**하고 싶다.
> 문제집 내용을 파악하여 북마크하거나, 내가 만든 문제집의 구성을 업데이트하기 위함이다.

**✅ Acceptance Criteria**
**[문제집 상세]**
- [ ] 좌측에서 선택한 문제집의 상세 정보(제목, 설명)와 포함된 **문제 목록**이 우측 패널에 표시되어야 한다.
- [ ] **[북마크]** 타인의 문제집인 경우 "북마크(가져오기)" 토글 버튼이 있어야 한다.
- [ ] **[편집 버튼]** 내가 만든 문제집인 경우에만 "편집" 버튼이 노출되어야 한다.

**[문제집 편집 (모달)]**
- [ ] 편집 버튼 클릭 시 **편집 전용 모달**이 열려야 한다.
- [ ] **[순서 변경]** 드래그 앤 드롭으로 문제 순서를 변경할 수 있어야 한다.
- [ ] **[문제 삭제]** 목록에서 특정 문제를 삭제할 수 있어야 한다.
- [ ] **[문제 추가]**
    - [ ] 모달 우측에 **문제 검색창**이 있어야 한다.
    - [ ] 이름이나 번호로 검색 시 결과 리스트가 나타나야 한다.
    - [ ] 각 검색 결과에는 "문제 링크(새창)"와 "추가" 버튼이 있어 즉시 문제집에 담을 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] `WorkbookDetail` 뷰 구현
- [ ] `WorkbookEditModal` 구현 (React DnD, Split Layout)
- [ ] 문제 검색 및 추가 핸들러 구현

### 05.5. 문제집 API (Backend)
**User Story**
> **사용자**로서, **문제집 데이터를 서버에 저장하고 조회**하고 싶다.
> 기기 간 동기화를 보장하고 타인과 공유하기 위함이다.

**✅ Acceptance Criteria**
- [ ] 문제집 메타데이터(제목, 설명)와 포함된 문제 목록(`WORKBOOK_PROBLEMS`)이 정상적으로 저장/수정되어야 한다.
- [ ] `GET /api/v1/workbooks/{id}` 호출 시 로그인한 사용자가 푼 문제인지(Solved 여부)를 마킹하여 반환해야 한다.
- [ ] 문제집 삭제 시 매핑 테이블 데이터도 함께 정리(Cascade)되어야 한다.

**🛠 Implementation Tasks**
- [ ] `Workbook` 관련 Entity, Repository, Service 구현
- [ ] 문제집 상세 조회 시 풀이 상태(`isSolved`) 매핑 로직 구현

### 05.6. 문제 임베딩 파이프라인 (AI)
**User Story**
> **시스템**으로서, **문제 설명을 벡터 임베딩으로 변환**하고 싶다.
> 키워드가 일치하지 않아도 의미적으로 유사한 문제를 찾기 위함이다.

**✅ Acceptance Criteria**
- [ ] 새로운 문제가 추가되면 설명 텍스트를 추출하여 임베딩 모델(text-embedding-3-small)을 통과시켜야 한다.
- [ ] 생성된 벡터 데이터를 Vector DB(ChromaDB)에 인덱싱하여 저장해야 한다.

**🛠 Implementation Tasks**
- [ ] Python AI 서비스(FastAPI) 또는 Java DJL 연동
- [ ] 문제 데이터 전처리 및 임베딩 API 구현
- [ ] Vector DB 연결 및 스키마 설정

### 05.7. 시맨틱 검색 로직 (AI)
**User Story**
> **사용자**으로서, **단순 키워드가 아닌 개념(예: "최단 경로")으로 검색**하고 싶다.
> 문제의 의도나 유형에 맞는 연습 문제를 발견하기 위함이다.

**✅ Acceptance Criteria**
- [ ] 사용자 검색어 쿼리를 벡터로 변환하여 Vector DB에 질의해야 한다.
- [ ] 코사인 유사도(Cosine Similarity)가 높은 상위 K개의 문제를 반환해야 한다.
- [ ] 검색 결과에 유사도 점수나 매칭된 이유가 포함되면 좋다.

**🛠 Implementation Tasks**
- [ ] 시맨틱 검색 Service 로직 구현
- [ ] 검색 결과 랭킹 및 필터링(푼 문제 제외 등) 로직

### 05.8. 추천 엔진 (AI)
**User Story**
> **사용자**로서, **내 티어와 약점에 기반한 "다음 문제" 추천**을 받고 싶다.
> 효율적으로 실력을 향상시키기 위함이다.

**✅ Acceptance Criteria**
- [ ] 사용자가 자주 틀리는 태그(예: DP, 그래프)를 분석하여 유사한 난이도의 문제를 추천해야 한다.
- [ ] 추천 사유 생성: 선정된 후보 문제와 사용자 데이터를 GPT-4o-mini에 전달하여 맞춤형 추천 사유(예: "최근 DP 정답률이 낮아서 추천")를 생성해야 한다.
- [ ] 생성된 결과(문제ID, 추천사유)는 Redis에 저장되어 24시간 동안 유지된다.
- [ ] 이미 푼 문제는 추천 목록에서 제외되어야 한다.

**🛠 Implementation Tasks**
- [ ] 사용자 취약 태그 분석 및 문제 추출: 유저의 최근 오답 기록을 분석하여 취약한 알고리즘 유형을 파악, 이에 맞는 문제를 ChromaDB에서 검색하는 모듈 구현
- [ ] GPT-4o-mini 기반 추천 사유 생성: 선정된 문제와 유저의 학습 상태를 바탕으로 맞춤형 추천 멘트를 생성하는 LLM 기능 구현
- [ ] Redis 결과 저장 및 만료 설정: 생성된 데이터를 Redis에 JSON 형태로 저장하고, 24시간 뒤 자동으로 삭제되도록 TTL 스케줄러 설정