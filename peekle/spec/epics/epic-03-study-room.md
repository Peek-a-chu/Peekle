# Epic-03: 스터디 룸 시스템 (Study Room System)

## 📌 Overview
이 문서는 **스터디 룸 시스템**에 대한 전체 에픽 및 스토리 세부 내역을 제공합니다. 캘린더 기반 문제 배정, 실시간 화상/코드 협업, 확장 프로그램 연동 제출 프로세스를 다룹니다.

## 📋 Stories

### 03.1. 스터디 레이아웃 및 비디오 그리드 (Frontend)
**User Story**
> **사용자**로서, **효율적인 화면 배치와 참여자들의 상태**를 보고 싶다.
> 문제, IDE, 화상, 채팅을 한 화면에서 끊김 없이 사용하기 위함이다.

**✅ Acceptance Criteria**
- [ ] **[상단 비디오 영역]** 일자(Row) 형태로 배치되며, 내 화면이 맨 왼쪽에 고정되어야 한다.
- [ ] 다른 참여자들은 **최근 발화 순서(Active Speaker)**대로 내 오른쪽으로 정렬되어야 한다.
- [ ] 다른 유저의 비디오를 클릭하면 해당 유저의 **실시간 코드 보기 모드**로 전환되어야 한다.
- [ ] **[초대 및 메뉴]** 상단 우측에 초대 링크 복사 버튼과 햄버거 메뉴(방 설정/나가기)가 있어야 한다.

**🛠 Implementation Tasks**
- [ ] Grid Layout 퍼블리싱 (Left: List, Center: IDE, Right: Chat)
- [ ] OpenVidu Stream 정렬 로직 (Self First + Active Speaker Sort)
- [ ] `useRoomStore`에 `viewingUser` 상태 관리 추가

### 03.2. 문제 목록 및 캘린더 (Left Panel)
**User Story**
> **사용자**로서, **날짜별로 배정된 문제를 확인하고 관리**하고 싶다.
> 스터디 일정에 맞춰 체계적으로 문제를 풀기 위함이다.

**✅ Acceptance Criteria**
- [ ] 달력에서 날짜 선택 시 해당 일자에 추가된 문제 목록이 표시되어야 한다.
- [ ] 문제 추가 시 이름/번호로 검색하여 등록할 수 있어야 한다.
- [ ] 각 문제는 '제목', '풀이 현황(푼 인원/전체 인원)', '내 풀이 여부(Check)'가 표시되어야 한다.
- [ ] **[힌트 버튼]** 클릭 시에만 해당 문제의 티어와 태그가 노출되어야 한다 (기본 숨김).
- [ ] **[남의 코드 보기 버튼]** 클릭 시 모달에 참여자 목록(본인 제외)이 뜨고, 선택 시 해당 유저의 제출 코드를(저장된) 볼 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] `ProblemList` 및 `CalendarWidget` 컴포넌트 구현
- [ ] 문제 검색 및 추가 API 연동
- [ ] `SubmissionViewerModal` 구현 (API `GET /submissions` 조회)

### 03.3. 협업 IDE 및 제출 시스템 (Center Panel)
**User Story**
> **사용자**로서, **코드를 작성하고 백준에 자동으로 제출**하고 싶다.
> IDE에서 작성한 코드를 복사하고 붙여넣는 번거로움을 줄이기 위함이다.

**✅ Acceptance Criteria**
- [ ] **[IDE 설정]** 테마(Dark/White), 언어(C++/Python/Java) 선택이 가능해야 한다.
- [ ] **[제출 버튼 로직]** 클릭 시 다음 프로세스가 순차 실행되어야 한다:
    1. 현재 IDE 코드 클립보드 복사
    2. 확장 프로그램을 통해 백준 문제 페이지 새 탭 오픈
    3. (확장 프로그램) 언어 설정을 선택된 언어로 변경
    4. (확장 프로그램) 코드 붙여넣기 수행
- [ ] **[하단 툴바]** 마이크, 카메라, 스피커 ON/OFF 토글 및 화이트보드, 설정 버튼이 배치되어야 한다.
- [ ] 설정 버튼 클릭 시 `Epic-08`의 설정 모달이 열려야 한다.

**🛠 Implementation Tasks**
- [ ] Monaco Editor 설정 핸들러 구현
- [ ] `SubmissionHandler` 구현 (`window.postMessage` to Extension)
- [ ] 하단 Control Bar 컴포넌트 구현

### 03.4. 화이트보드 시스템 (Overlay)
**User Story**
> **참여자**로서, **화이트보드를 열어 시각적으로 설명**하고 싶다.
> 말로 설명하기 어려운 알고리즘이나 로직을 그림으로 공유하기 위함이다.

**✅ Acceptance Criteria**
- [ ] 한 명이 화이트보드를 오픈하면, 비디오 그리드 왼쪽에 **미리보기 화면**이 생겨야 한다.
- [ ] 미리보기나 툴바의 버튼을 클릭하면 IDE 위에 **화이트보드 오버레이**가 열려야 한다.
- [ ] 다른 사람들은 이 상태에서 IDE를 볼 수 없으며 화이트보드 화면을 공유받아야 한다.

**🛠 Implementation Tasks**
- [ ] Canvas API 또는 화이트보드 라이브러리(Excalidraw 등) 도입
- [ ] WebSocket을 통한 드로잉 데이터 동기화
- [ ] 오버레이 모달 UI 처리

### 03.5. 코드 보기 모드 (Real-time & Saved)
**User Story**
> **사용자**로서, **다른 사람의 코드를(실시간 또는 제출된) 편하게 검토**하고 싶다.
> 코드를 참고하거나 리뷰해주기 위함이다.

**✅ Acceptance Criteria**
- [ ] **[실시간 보기]** 상단 비디오 클릭 또는 참여자 목록 클릭 시:
    - 내 IDE 오른쪽에 대상 유저의 코드가 실시간으로 표시된다 (커서/하이라이팅 포함).
- [ ] **[저장된 코드 보기]** 문제 목록에서 선택 시:
    - 내 IDE 오른쪽에 읽기 전용으로 표시된다 (하이라이팅 X).
- [ ] 남의 코드를 보고 있을 때 **"내 코드만 보기"** 버튼이 활성화되며, 클릭 시 원래대로 돌아와야 한다.
- [ ] **[공유하기 버튼]** 남의 코드를 보는 중 활성화되며, 클릭 시 채팅창이 공유 모드로 전환되어야 한다.

**🛠 Implementation Tasks**
- [ ] Split Editor (Diff Editor 유사 UI) 구현
- [ ] 실시간 코드 동기화 로직 (`CRDT` or `Stomp`)
- [ ] View Mode 상태 관리 (`ONLY_MINE`, `SPLIT_REALTIME`, `SPLIT_SAVED`)

### 03.6. 채팅 및 코드 공유 (Right Panel)
**User Story**
> **사용자**로서, **코드에 대해 채팅으로 소통하고 특정 풀이를 공유**하고 싶다.
> "이 부분 봐주세요"라고 말할 때 정확한 맥락을 전달하기 위함이다.

**✅ Acceptance Criteria**
- [ ] **[채팅창]** 마크다운 렌더링을 지원해야 한다.
- [ ] **[코드 공유]** 공유하기 모드에서 메시지 전송 시, 타 참여자에게 "코드 공유 카드" 형태의 말풍선이 보여야 한다.
- [ ] 공유 카드를 클릭하면 해당 유저의 해당 문제 풀이 뷰로 즉시 이동해야 한다.
- [ ] 채팅 탭과 참여자 목록 탭을 토글할 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] Markdown Parser (`react-markdown`) 적용
- [ ] Chat Message 타입 정의 (`TEXT`, `CODE_SHARE`)
- [ ] 공유 메시지 클릭 핸들러 (View Mode 전환)

### 03.7. 참여자 관리 및 방장 권한 (Right Panel)
**User Story**
> **사용자(및 방장)**로서, **현재 참여 인원을 확인하고 방을 관리**하고 싶다.
> 쾌적한 스터디 환경을 유지하기 위함이다.

**✅ Acceptance Criteria**
- [ ] 참여자 탭 헤더에 현재 인원/최대 인원(예: 3/4)이 표시되어야 한다.
- [ ] 유저는 온라인/오프라인으로 구분되어 리스팅되어야 한다.
- [ ] 온라인 유저 클릭 시 "실시간 코드 보기"가 트리거되어야 한다.
- [ ] **[방장 권한]** 유저 클릭 시 메뉴(Mic/Cam Off, 추방, 권한 위임)가 나와야 한다.
- [ ] 목록 상단의 **"모두 음소거"** 버튼으로 전체 마이크를 끌 수 있어야 한다.

**🛠 Implementation Tasks**
- [ ] Participant List 컴포넌트 구현
- [ ] 방장 전용 Control API 연동 (`KICK`, `MUTE_ALL`)
- [ ] Socket 이벤트 핸들러 (`USER_JOIN`, `USER_LEAVE`, `USER_UPDATE`)

### 03.8. 방 관리 (Header Menu)
**User Story**
> **방장**으로서, **방 설정을 변경하거나 방을 삭제**하고 싶다.
> 스터디 운영 정책을 변경하거나 종료하기 위함이다.

**✅ Acceptance Criteria**
- [ ] 햄버거 메뉴 클릭 시 방장은 **[방 설정, 방 삭제]**, 일반 유저는 **[방 나가기]**가 보여야 한다.
- [ ] **[방 설정]** 제목, 공개 여부 등을 수정하는 모달이 떠야 한다.
- [ ] **[방 삭제]** "정말 삭제하시겠습니까?" 경고 모달 후 삭제 처리가 되어야 한다.

**🛠 Implementation Tasks**
- [ ] Room Setting Modal 구현
- [ ] 방 삭제/나가기 API 연동 및 리다이렉트 처리